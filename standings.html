<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Standings ‚Äì Sacred Sundays</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="./styles.css?v=2025-09-11a" />

  <style>
/* High-contrast playoff badge (replaces checkbox) */
.pf-chip{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width: 15px;
  height: 15px;
  padding: 0 6px;
  border-radius: 8px;
  font-weight: 800;
  font-size: 9px;
  line-height: 1;
  letter-spacing: .2px;
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.18);
}
.pf-yes{
  background: #b6d7a8;        /* green-600 */
  color: #000000;
  border: 1px solid rgba(0,0,0,.15);
}
.pf-yes::before{
  content: "‚úì";
  margin-right: 4px;
  font-weight: 900;
}

/* Make the Playoff Bound header centered & a bit tighter */
#standingsTable th.playoff-col {
  text-align: center;
  width: 35px;                /* works with your JS col width */
}

/* Keep table density good on desktop (already suggested earlier) */
@media (min-width: 1200px){
  #standingsTable th, #standingsTable td { padding: 10px 8px; }
}

    /* ========== Header (match Weekly Winners layout) ========== */
    :root{
      --brand:#0f1b2a;
    }
    header{background:var(--brand);color:#fff;padding:14px 12px 12px}
    header .wrap{max-width:1100px;margin:0 auto}
    header h1{margin:0 0 12px;text-align:center;font-size:34px;letter-spacing:.2px}

    /* Pills (anchor == button) */
    .pill, .pill:link, .pill:visited, .pill:focus, .pill:active{
      box-sizing:border-box;display:inline-flex;align-items:center;justify-content:center;
      height:44px;padding:10px 16px;border-radius:9999px;border:2px dashed rgba(255,255,255,.55);
      background:transparent;color:#fff;text-decoration:none;font:700 16px/1 system-ui,Segoe UI,Roboto,Helvetica,Arial;
      gap:8px;cursor:pointer;transition:background .15s,border-color .15s}
    .pill:hover{background:rgba(255,255,255,.07)}
    .pill .ico{font-size:18px;line-height:1}

    .pills{display:flex;flex-direction:column;gap:12px}
    .pills .row{display:grid;gap:12px}
    .pills .row1{grid-template-columns:1fr 1fr}
    .pills .row2{grid-template-columns:1fr 1fr 1fr}
    .pills .row .pill{width:100%}

    /* Make header + main container wider on desktop so the table can use full width */
    @media (min-width: 1300px){
      header .wrap,
      main .wrap{
        max-width: 1920px;
      }
    }

    /* Optional: slightly denser table padding on desktop */
    @media (min-width: 1200px){
      #standingsTable th,
      #standingsTable td{
        padding: 10px 8px;
      }
    }

    /* ---- Simple modal for iOS "Turn Phone" prompt ---- */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal{background:#0f172a;color:#e5e7eb;border:1px solid #253045;border-radius:14px;padding:18px 16px;max-width:320px;width:92%}
    .modal h3{margin:0 0 6px;font-size:18px;text-align:center}
    .modal p{margin:0 0 14px;text-align:center;color:#94a3b8}
    .modal .rotate{font-size:40px;display:block;text-align:center;margin-bottom:6px}
    .modal .actions{display:flex;justify-content:center}
    .modal .actions .pill{border-color:#64748b}

    /* Small phones tighten pills slightly */
    @media (max-width:420px){
      .pill{height:42px;padding:10px 14px;font-size:15px}
      .pill .ico{font-size:17px}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>üèÜ Standings</h1>

      <!-- Pills -->
      <div class="pills">
        <div class="row row1">
          <a class="pill" id="homeBtn" href="index.html"><span class="ico">üè†</span>Home</a>
          <button class="pill" id="refresh" type="button"><span class="ico">‚Üª</span>Reset Page</button>
        </div>
        <div class="row row2">
          <button class="pill" id="viewToggle" type="button"><span class="ico">üñ•Ô∏è</span>Desktop View</button>
          <button class="pill" id="exportCSV" type="button"><span class="ico">‚¨áÔ∏è</span>CSV</button>
          <button class="pill" id="darkModeToggle" type="button" aria-pressed="false"><span class="ico">üåô</span>Dark Mode</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <section class="card">
        <div class="toolbar">
          <span class="status" id="status"><span class="dot" aria-hidden="true"></span> Loading standings‚Ä¶</span>
          <span class="legend" aria-hidden="true">
            <span class="chip"><i class="win-i"></i> Win</span>
            <span class="chip"><i class="loss-i"></i> Loss</span>
            <span class="chip"><span aria-hidden="true">üò¥</span> BYE indicator</span>
          </span>
        </div>

        <div class="table-wrap" id="tableWrap" role="region" aria-label="Current League Standings">
          <table id="standingsTable" aria-describedby="status">
            <colgroup></colgroup>
            <thead id="thead"></thead>
            <tbody id="tbody"></tbody>
          </table>
          <!-- Mobile cards -->
          <div id="cards" class="cards" aria-label="Standings (mobile cards)"></div>
        </div>
      </section>
    </div>
  </main>

  <!-- iOS rotate prompt -->
  <div id="turnPhoneModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="tp-title">
    <div class="modal">
      <div class="rotate">üîÑ</div>
      <h3 id="tp-title">Best in Landscape Mode</h3>
      <p></p>
      <div class="actions">
        <button class="pill" id="tpOk" type="button">OK</button>
      </div>
    </div>
  </div>

  <footer>
    <p class="muted">Views: <span id="page-views">‚Äî</span></p>
    <div class="wrap">
      <p>&copy; 2025 Sacred Sundays League</p>
    </div>
  </footer>

  <script>
/* ===================== CONFIG ===================== */
const CONFIG = {
  apiKey: 'AIzaSyDqIFrO42J4b0faekmmEGTjKmbZ4PRGc6M',
  sheetId: '1vNjLCTxmM1c09aONXyQYpGTPwcGG-hmnflq8-ZC3Rmo',
  rangeA1: 'Standings!A1:W19',
  gid: '2112652019',
  resourceKey: ''
};

/* ===================== Helpers ===================== */
const $ = (s, el=document)=>el.querySelector(s);
const $$ = (s, el=document)=>Array.from(el.querySelectorAll(s));
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

/* Team logo progressive loader (tries several extensions) */
const LOGO_OVERRIDES = { /* optional custom slugs per team */ };
const slug = s => (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

function attachTeamLogo(td, teamName){
  const base = LOGO_OVERRIDES[teamName] || slug(teamName);
  const exts = ['.png', '.svg', '.webp', '.jpg', '.jpeg'];
  const img = document.createElement('img');
  img.className = 'team-logo';
  img.alt = `${teamName} logo`;
  img.loading = 'lazy';
  img.referrerPolicy = 'no-referrer';
  let i = 0;
  const tryNext = () => {
    if (i >= exts.length){ img.style.display='none'; return; }
    img.src = `Images/teams/${base}${exts[i++]}`;
  };
  img.onerror = tryNext;
  tryNext();
  td.appendChild(img);

  const span = document.createElement('span');
  span.className = 'team-name';
  span.textContent = teamName;
  td.appendChild(span);
}

/* ===================== Theme ===================== */
const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
const savedTheme  = localStorage.getItem('theme');
const rootEl      = document.documentElement;

function applyTheme(mode){
  const dark = mode==='dark' || (mode==='auto' && prefersDark);
  rootEl.classList.toggle('dark', dark);
  $('#darkModeToggle')?.setAttribute('aria-pressed', dark ? 'true' : 'false');
}
applyTheme(savedTheme || 'auto');

$('#darkModeToggle').addEventListener('click', ()=>{
  const willDark = !rootEl.classList.contains('dark');
  rootEl.classList.toggle('dark', willDark);
  localStorage.setItem('theme', willDark ? 'dark' : 'light');
  $('#darkModeToggle').setAttribute('aria-pressed', willDark ? 'true' : 'false');
});

/* ===================== Skeleton ===================== */
function renderSkeleton(rows=6, cols=12){
  const tbody = $('#tbody'); tbody.innerHTML = '';
  for(let r=0;r<rows;r++){
    const tr = document.createElement('tr'); tr.className='skeleton-row';
    for(let c=0;c<cols;c++){
      const td = document.createElement('td'); td.textContent='\u00a0';
      if(c===0) td.classList.add('sticky');
      if(c===1) td.classList.add('sticky','second');
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }
}

/* ===================== Data loading ===================== */
const CACHE_KEY='standings-cache-v3', CACHE_TTL=0;

function apiUrl(){
  const base=`https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.sheetId}/values/${encodeURIComponent(CONFIG.rangeA1)}?key=${CONFIG.apiKey}&majorDimension=ROWS`;
  return CONFIG.resourceKey ? `${base}&resourcekey=${encodeURIComponent(CONFIG.resourceKey)}` : base;
}
function csvUrl(){ return `https://docs.google.com/spreadsheets/d/${CONFIG.sheetId}/export?format=csv&gid=${CONFIG.gid}`; }

/* tiny CSV parser */
function parseCSV(text){
  const rows=[]; let cur='', row=[], inQ=false;
  for(let i=0;i<text.length;i++){
    const ch=text[i], nx=text[i+1];
    if(inQ){
      if(ch=='"' && nx=='"'){cur+='"';i++;}
      else if(ch=='"'){inQ=false;}
      else cur+=ch;
    }else{
      if(ch=='"') inQ=true;
      else if(ch==','){row.push(cur);cur='';}
      else if(ch=='\n'){row.push(cur);rows.push(row);row=[];cur='';}
      else if(ch!='\r'){cur+=ch;}
    }
  }
  row.push(cur); rows.push(row); return rows;
}
function colsFromRange(r){ const m=/:([A-Z]+)\d+/i.exec(r); if(!m) return 23; let n=0; for(const c of m[1]) n=n*26+(c.charCodeAt(0)-64); return n; }
function rowsFromRange(r){ const m= /:(?:[A-Z]+)(\d+)/i.exec(r); return m?parseInt(m[1],10):19; }

async function getStandings(){
  const now=Date.now();
  try{
    const cached=JSON.parse(localStorage.getItem(CACHE_KEY)||'null');
    if(cached && (now-cached.time)<CACHE_TTL) return cached.data;
  }catch{}

  // Try API
  try{
    const res=await fetch(apiUrl()+`&_=${Date.now()}`,{cache:'no-store'});
    if(!res.ok){ throw new Error(`API HTTP ${res.status}`); }
    const json=await res.json();
    if(!json.values || !json.values.length) throw new Error('Empty API');
    try{ localStorage.setItem(CACHE_KEY, JSON.stringify({time:now,data:json})); }catch{}
    $('#status').textContent='Loaded via Google Sheets API';
    return json;
  }catch(e){
    console.warn('API failed; falling back to CSV', e);
  }

  // CSV fallback
  const res=await fetch(csvUrl()+`&_=${Date.now()}`,{cache:'no-store'});
  if(!res.ok) throw new Error(`CSV HTTP ${res.status}`);
  const text=await res.text();
  const rows=parseCSV(text);
  const wantCols=colsFromRange(CONFIG.rangeA1);
  const wantRows=rowsFromRange(CONFIG.rangeA1);
  const trimmed=rows.slice(0,wantRows).map(r=>r.slice(0,wantCols));
  const json={range:CONFIG.rangeA1,majorDimension:'ROWS',values:trimmed};
  try{ localStorage.setItem(CACHE_KEY, JSON.stringify({time:now,data:json})); }catch{}
  $('#status').textContent='Loaded via CSV fallback';
  return json;
}

/* ===================== Table render ===================== */
let CURRENT_VALUES=null;

function setStickyOffsets(){
  const header=document.querySelector('header');
  const toolbar=document.querySelector('.toolbar');
  const hh=header?header.offsetHeight:0;
  const th=toolbar?toolbar.offsetHeight:0;
  document.documentElement.style.setProperty('--header-h', hh+'px');
  document.documentElement.style.setProperty('--table-sticky-top', (hh+th)+'px');
}
window.addEventListener('resize', setStickyOffsets);
document.addEventListener('DOMContentLoaded', setStickyOffsets);

function buildTable(values){
  CURRENT_VALUES=values;
  const thead=$('#thead'), tbody=$('#tbody'), table=$('#standingsTable');
  thead.innerHTML=''; tbody.innerHTML='';

  const COLS=Math.max(...values.map(r=>r?.length||0)); if(!Number.isFinite(COLS)||COLS<3) return;

  // --- Compact column widths so full table fits on laptop screens
  const COL_A  = 55;   // px  (Playoff col)
  const COL_B  = 210;  // px  (team name + logo)
  const WEEK_W = 50;   // px  (per week col)
  const SUMM_W = 56;   // px  (summary columns)

  table.querySelector('colgroup')?.remove();
  const cg=document.createElement('colgroup'), out=[];
  out.push(`<col style="width:${COL_A}px">`);
  out.push(`<col style="width:${COL_B}px">`);
  for(let i=2;i<=15 && i<COLS;i++) out.push(`<col style="width:${WEEK_W}px">`);
  for(let i=16;i<COLS;i++) out.push(`<col style="width:${SUMM_W}px">`);
  cg.innerHTML=out.join(''); table.insertBefore(cg, thead);

  // THEAD 1: Top A1 banner
  const trTop=document.createElement('tr');
  const thTop=document.createElement('th');
  const a1=(values[0]?.[0]||'').toString().replace(/[\r\n]+/g,' ').trim();
  thTop.colSpan=COLS; thTop.textContent=a1||'Standings';
  trTop.appendChild(thTop); thead.appendChild(trTop);

  // THEAD 2: column headers (fixed)
  const trHdr = document.createElement('tr');
  const headerRow = values[1] || [];
  for (let colIndex = 0; colIndex < COLS; colIndex++) {
    const th = document.createElement('th');
    th.textContent = headerRow[colIndex] ?? '';
    th.dataset.col = colIndex;
    th.classList.add('sortable');
    if (colIndex === 0)  th.classList.add('playoff-col'); // center & narrow PF col
    if (colIndex === 16) th.classList.add('left-divider'); // Q divider
    trHdr.appendChild(th);
  }
  thead.appendChild(trHdr);

  // TBODY rows
  for(let r=2;r<values.length;r++){
    const row=values[r]||[], tr=document.createElement('tr');
    if(r===15) tr.classList.add('divider-row');
    if(r===7)  tr.classList.add('double-border');
    tr.dataset.rowIndex=r;

    for(let c=0;c<COLS;c++){
      let cell=row[c]??'';
      const isGameCell   = r>=2 && r<=14 && c>=2 && c<=15;
      const isSummaryRow = r===18 && c>=2 && c<=15;
      const isBlueFont   = r===16 && c<=15;

      const hasBye = (isGameCell||isSummaryRow) && String(cell).toUpperCase().includes('BYE');
      if(hasBye) cell=String(cell).replace(/BYE/gi,'').trim();

      let score=cell, result='';
      if(isGameCell || isSummaryRow){
        const up=String(cell).toUpperCase();
        if(up.includes('WIN'))  { score=isGameCell?String(cell).replace(/WIN/gi,'').trim():''; result='Win'; }
        if(up.includes('LOSS')) { score=isGameCell?String(cell).replace(/LOSS/gi,'').trim():''; result='Loss'; }
      }

      const td=document.createElement('td');
      if(c===1) td.classList.add('team-name-cell','sticky','second','click-highlight');
      if(c===16) td.classList.add('left-divider');
      if(isBlueFont || hasBye) td.classList.add('blue-font');
      if(result==='Win')  td.classList.add('win');
      if(result==='Loss') td.classList.add('loss');

      // Playoff Bound column (A): show badge only when TRUE; hide if FALSE
      if (c === 0) {
        const isTrue = String(cell).toUpperCase() === 'TRUE';
        // expose a flag for mobile cards
        tr.dataset.playoff = isTrue ? 'true' : 'false';

        if (isTrue) {
          td.innerHTML = `<span class="pf-chip pf-yes" title="Playoff team"></span>`;

          td.style.textAlign = 'center';
        } else {
          td.innerHTML = ""; // hide when FALSE
        }
        td.classList.add('checkbox-cell','sticky');
        tr.appendChild(td);
        continue;
      }

      // Team + logo
      if(c===1){
        const team=String(cell||'').trim();
        tr.dataset.team=team;
        attachTeamLogo(td, team);
        td.addEventListener('click', ()=>toggleRowHighlight(tr));
        tr.appendChild(td); continue;
      }

      // Game cells: show score, optional üò¥, hide Win/Loss words
      if(isGameCell && (result||hasBye)){
        td.innerHTML=`${score||''}${hasBye?' <span title="Bye Week">üò¥</span>':''}`;
        tr.appendChild(td); continue;
      }
      // Row 19 summary: show Win/Loss word again
      if(isSummaryRow && result){
        td.innerHTML=`<span class="result-label">${result}</span>`; tr.appendChild(td); continue;
      }

      td.textContent=cell; tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }

  attachSortHandlers();
  buildCards();
  setStickyOffsets();
}

/* Sorting */
let sortState={col:null,dir:1};
function attachSortHandlers(){
  $$('#thead tr:nth-child(2) th').forEach(th=>{
    th.addEventListener('click', ()=>{
      const col=Number(th.dataset.col); if(Number.isNaN(col)) return;
      sortState = (sortState.col===col) ? {col,dir:-sortState.dir} : {col,dir:1};
      doSort(col, sortState.dir);
      markSortedHeader(col, sortState.dir);
      buildCards(); setStickyOffsets();
    });
  });
}
function markSortedHeader(col,dir){
  $$('#thead tr:nth-child(2) th').forEach(th=>th.classList.remove('sorted-asc','sorted-desc'));
  const target=$(`#thead tr:nth-child(2) th[data-col="${col}"]`);
  if(target) target.classList.add(dir===1?'sorted-asc':'sorted-desc');
}
function doSort(col,dir){
  const tbody=$('#tbody');
  const rows=Array.from(tbody.rows);
  const dividerIdx=rows.findIndex(r=>r.classList.contains('divider-row'));
  const before=dividerIdx>=0?rows.slice(0,dividerIdx):rows;
  const after =dividerIdx>=0?rows.slice(dividerIdx):[];
  const sortable=before.filter(r=>!r.classList.contains('double-border'));
  sortable.sort((a,b)=>{
    const A=a.cells[col]?.textContent.trim()??'', B=b.cells[col]?.textContent.trim()??'';
    const nA=parseFloat(A.replace(/[% ,]/g,'')), nB=parseFloat(B.replace(/[% ,]/g,''));
    const aNum=!Number.isNaN(nA), bNum=!Number.isNaN(nB);
    if(aNum&&bNum) return (nA-nB)*dir;
    return A.localeCompare(B, undefined, {numeric:true,sensitivity:'base'})*dir;
  });
  const ordered=dividerIdx>=0?[...sortable,...after]:sortable;
  tbody.innerHTML=''; ordered.forEach(r=>tbody.appendChild(r));
}

/* ===================== Mobile Cards ===================== */
/* iOS rule: score-only cards for these "teams" */
const IOS_SCORE_ONLY = new Set(["Bye Week Score","Weekly Avg Score","Bye Week Win or Loss"]);

function buildCards(){
  const cards=$('#cards'); if(!cards) return; cards.innerHTML='';
  const header=(CURRENT_VALUES&&CURRENT_VALUES[1])||[];
  const dataRows=Array.from(document.querySelectorAll('#tbody tr')).filter(r=>!r.classList.contains('divider-row'));
  const any=dataRows[0]; const COLS=any ? any.cells.length : header.length;

  dataRows.forEach(tr=>{
    const cells=Array.from(tr.cells); if(!cells.length) return;

    const teamCell=cells[1];
    const team = tr.dataset.team || (teamCell?.querySelector('.team-name')?.textContent.trim()) || 'Team';
    const isPlayoff = (tr.dataset.playoff === 'true');

    const card=document.createElement('article'); card.className='card-row';

    // HEAD: logo + name + playoff chip (if applicable)
    const head=document.createElement('div'); head.className='cr-head';
    const logo=teamCell?.querySelector('img.team-logo')?.cloneNode(true);
    if(logo) head.appendChild(logo);
    const name=document.createElement('h3'); name.textContent=team; head.appendChild(name);

    // Playoff chip
    if(isPlayoff && !(isIOS && IOS_SCORE_ONLY.has(team))){
      const right=document.createElement('div'); right.className='ml-auto';
      const chip=document.createElement('span'); chip.className='chip'; chip.title='Playoff team'; chip.textContent='‚úÖ Playoffs';
      right.appendChild(chip); head.appendChild(right);
    }

    // META (summary Q..end)
    const meta=document.createElement('ul'); meta.className='cr-meta';
    for(let c=16;c<COLS;c++){
      const label=header[c] ?? `C${c+1}`;
      const val=cells[c]?.textContent.trim()||'';
      const li=document.createElement('li'); li.innerHTML=`<strong>${label}:</strong> ${val}`; meta.appendChild(li);
    }

    // WEEKS (C..P)
    const weeks=document.createElement('div'); weeks.className='cr-weeks';
    for(let c=2;c<=15;c++){
      const w=document.createElement('span');
      const txt=cells[c]?.textContent.trim()||'';
      w.textContent=txt||'¬∑';
      if(cells[c]?.classList.contains('win'))  w.classList.add('w');
      if(cells[c]?.classList.contains('loss')) w.classList.add('l');
      weeks.appendChild(w);
    }

    card.appendChild(head);

    // iOS score-only rule
    if(!(isIOS && IOS_SCORE_ONLY.has(team))){
      card.appendChild(meta);
    }
    card.appendChild(weeks);
    cards.appendChild(card);
  });
}

/* Row highlight */
function toggleRowHighlight(tr){
  const was=tr.classList.contains('row-highlight');
  $$('#tbody tr').forEach(r=>r.classList.remove('row-highlight'));
  if(!was) tr.classList.add('row-highlight');
}
document.addEventListener('keydown', e=>{
  if(e.key==='Escape') $$('#tbody tr').forEach(r=>r.classList.remove('row-highlight'));
});

/* CSV Export */
function toCSV(values){
  return values.map(r=>r.map(v=>{
    const s=(v??'').toString().replaceAll('"','""');
    return (s.includes(',')||s.includes('"')||s.includes('\n'))?`"${s}"`:s;
  }).join(',')).join('\n');
}
function download(name, text){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([text],{type:'text/csv'}));
  a.download=name; a.click(); URL.revokeObjectURL(a.href);
}

/* ===================== Init & Events ===================== */
let LAST_DATA=null;

async function load(){
  $('#status').innerHTML='<span class="dot"></span> Loading standings‚Ä¶';
  renderSkeleton();
  try{
    const json=await getStandings();
    const rows=json.values||[]; if(!rows.length) throw new Error('No rows returned.');
    buildTable(rows); LAST_DATA=rows;

    const sheetDate=(rows[1]?.[0]||'').toString().trim();
    const isMobile=window.matchMedia("(max-width: 900px)").matches;
    $('#status').textContent = isMobile && sheetDate ? ` ${sheetDate}` : `Last Page Refresh: ${new Date().toLocaleString()}`;
  }catch(err){
    console.error('load failed', err);
    const cols=colsFromRange(CONFIG.rangeA1)||24;
    $('#tbody').innerHTML = `<tr><td colspan="${cols}">‚ö†Ô∏è ${err.message||'Error'} <button class="pill" id="retry" type="button"><span class="ico">‚Üª</span>Try again</button></td></tr>`;
    $('#status').textContent='Error loading.';
    $('#retry')?.addEventListener('click', load);
  }
}

$('#refresh').addEventListener('click', ()=>{
  try{ localStorage.removeItem(CACHE_KEY); }catch{}
  load();
});
$('#exportCSV').addEventListener('click', ()=>{
  if(!LAST_DATA) return;
  download('sacred-sundays-standings.csv', toCSV(LAST_DATA));
});

/* Desktop/Mobile view toggle + iOS Turn Phone modal */
const viewToggle=$('#viewToggle');
const modalBackdrop=$('#turnPhoneModal');
const modalOk=$('#tpOk');

viewToggle.addEventListener('click', ()=>{
  const willDesktop = !document.body.classList.contains('force-desktop');
  document.body.classList.toggle('force-desktop', willDesktop);

  // Update label
  viewToggle.innerHTML = willDesktop ? '<span class="ico">üì±</span>Mobile View' : '<span class="ico">üñ•Ô∏è</span>Desktop View';

  // If switching *to* Desktop View on iOS, show the modal; user must tap OK to dismiss
  if (willDesktop && isIOS){
    modalBackdrop.style.display='flex';
  }
});
modalOk.addEventListener('click', ()=>{ modalBackdrop.style.display='none'; });

/* Kick off */
load();
  </script>

  <!-- Page view counter -->
  <script>
(function(){
  // Change this per page:
  const PAGE_KEY = "standings";       // or "weekly-winners"
  const NAMESPACE = "sacred-sundays"; // anything stable for your site

  const el = document.getElementById("page-views");
  if (!el) return;

  // Global counter (CountAPI)
  fetch(`https://api.countapi.xyz/hit/${encodeURIComponent(NAMESPACE)}/${encodeURIComponent(PAGE_KEY)}`)
    .then(r => r.json())
    .then(d => { if (d && typeof d.value === "number") el.textContent = d.value.toLocaleString(); })
    .catch(() => {
      // Fallback: per-browser local counter
      const localKey = `views:${PAGE_KEY}`;
      let n = parseInt(localStorage.getItem(localKey) || "0", 10);
      n++; localStorage.setItem(localKey, String(n));
      el.textContent = n.toLocaleString();
    });
})();
  </script>

</body>
</html>

